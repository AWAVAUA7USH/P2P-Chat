<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Manual Setup Chat</title>
</head>
<body>
    <h2>WebRTC Chat with Manual Setup</h2>
    <textarea id="messages" readonly style="width: 100%; height: 200px;"></textarea><br>
    <input id="message" type="text" placeholder="Type a message..." style="width: 100%;"><br>
    <button id="send">Send</button>

    <script>
        // Configuration settings for both peers
        const configuration = {
            iceServers: []  // No STUN/TURN server needed for local network
        };

        const peerConnection = new RTCPeerConnection(configuration);

        // Predefined ICE candidate for both peers
        const predefinedIceCandidate = new RTCIceCandidate({
            candidate: "candidate:1 1 UDP 2122260223 192.168.1.2 12345 typ host",  // Replace with the correct IP and port
            sdpMid: 'data',
            sdpMLineIndex: 0
        });

        // Manually add the ICE candidate
        peerConnection.addIceCandidate(predefinedIceCandidate);

        // Create a DataChannel
        const dataChannel = peerConnection.createDataChannel("chat");

        dataChannel.onopen = () => {
            console.log('Data channel is open');
        };

        dataChannel.onmessage = (event) => {
            const messagesTextarea = document.getElementById('messages');
            messagesTextarea.value += `Remote: ${event.data}\n`;
        };

        document.getElementById('send').onclick = () => {
            const message = document.getElementById('message').value;
            dataChannel.send(message);
            document.getElementById('messages').value += `Local: ${message}\n`;
            document.getElementById('message').value = '';
        };

        // Manually set local and remote SDP
        async function setupConnection() {
            const sdp = `v=0
o=- 0 0 IN IP4 127.0.0.1
s=-
t=0 0
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:data
a=sctpmap:5000 webrtc-datachannel 256
`; // Minimal SDP, modify as necessary

            // Manually set the SDP for both peers
            await peerConnection.setLocalDescription({ type: 'offer', sdp: sdp });
            await peerConnection.setRemoteDescription({ type: 'answer', sdp: sdp });
        }

        // Start the connection setup
        setupConnection();
    </script>
</body>
</html>
